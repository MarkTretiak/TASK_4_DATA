<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Book Store Analytics Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .metric-card { min-height: 90px; }
    .metric-label { font-size: 0.9rem; color: #666; }
    .metric-value { font-size: 1.4rem; font-weight: 600; }
    img.revenue-chart { max-width: 100%; border: 1px solid #ccc; border-radius: 8px; }
    pre.best-buyer { max-height: 200px; overflow-y: auto; background:#f8f9fa; padding:8px; }
  </style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">Book Store Analytics Dashboard</h1>

  <ul class="nav nav-tabs" id="datasetTabs" role="tablist"></ul>
  <div class="tab-content" id="datasetTabContent"></div>
</div>

<script>
async function loadData() {
  const resp = await fetch('all_summaries.json');
  const datasets = await resp.json();

  const tabs = document.getElementById('datasetTabs');
  const content = document.getElementById('datasetTabContent');

  datasets.forEach((ds, index) => {
    const dsId = ds.dataset_name;

    const li = document.createElement('li');
    li.className = 'nav-item';
    li.role = 'presentation';

    const btn = document.createElement('button');
    btn.className = 'nav-link' + (index === 0 ? ' active' : '');
    btn.id = dsId + '-tab';
    btn.dataset.bsToggle = 'tab';
    btn.dataset.bsTarget = '#' + dsId + '-pane';
    btn.type = 'button';
    btn.role = 'tab';
    btn.ariaControls = dsId + '-pane';
    btn.ariaSelected = index === 0 ? 'true' : 'false';
    btn.textContent = dsId;

    li.appendChild(btn);
    tabs.appendChild(li);

    const pane = document.createElement('div');
    pane.className = 'tab-pane fade' + (index === 0 ? ' show active' : '');
    pane.id = dsId + '-pane';
    pane.role = 'tabpanel';
    pane.ariaLabelledby = dsId + '-tab';

    pane.innerHTML = `
      <div class="mt-3">
        <div class="row g-3">
          <div class="col-md-3">
            <div class="card metric-card">
              <div class="card-body">
                <div class="metric-label">Unique users</div>
                <div class="metric-value">${ds.unique_users}</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card metric-card">
              <div class="card-body">
                <div class="metric-label">Unique author sets</div>
                <div class="metric-value">${ds.unique_author_sets}</div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card metric-card">
              <div class="card-body">
                <div class="metric-label">Most popular author(s)</div>
                <div class="metric-value">
                  ${ds.most_popular_authors && ds.most_popular_authors.length
                    ? ds.most_popular_authors.join(', ')
                    : '<span class="text-muted">n/a</span>'}
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <div class="row g-4">
          <div class="col-lg-6">
            <h5>Top 5 days by revenue</h5>
            <table class="table table-sm table-striped">
              <thead>
                <tr><th>Date (YYYY-MM-dd)</th><th>Revenue (USD)</th></tr>
              </thead>
              <tbody>
                ${ds.top_5_days.map(d =>
                  `<tr><td>${d.date}</td><td>${d.revenue.toFixed(2)}</td></tr>`
                ).join('')}
              </tbody>
            </table>
          </div>
          <div class="col-lg-6">
            <h5>Best buyer (all alias user_ids)</h5>
            <pre class="best-buyer mb-2">[${ds.best_buyer_ids.join(', ')}]</pre>
            <small class="text-muted">All these IDs belong to the same reconciled customer cluster.</small>
          </div>
        </div>

        <hr class="my-4">

        <h5>Daily revenue chart</h5>
        <img class="revenue-chart"
             src="${ds.dataset_name}_daily_revenue.png"
             alt="Daily revenue chart for ${ds.dataset_name}">
      </div>
    `;

    content.appendChild(pane);
  });
}

const bsScript = document.createElement('script');
bsScript.src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js";
bsScript.onload = loadData;
document.body.appendChild(bsScript);
</script>
</body>
</html>
